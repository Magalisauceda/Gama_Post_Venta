<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üå≥ GAMA Post Venta ‚Äî Ra√≠ces de √âxito</title>
<style>
  :root{
    --oro:#b98b3b; --cobre:#b66b3a; --beige:#f2eadf; --marfil:#fffaf0;
    --accent:#3b2f2a; --muted:#6f5f52; --green:#2ecc71; --red:#e74c3c;
    font-family:"Segoe UI", Roboto, Arial, sans-serif;
  }
  html,body{height:100%;margin:0;background:var(--beige);color:var(--accent);}
  .wrap{max-width:1100px;margin:18px auto;padding:18px;}
  .card{background:var(--marfil);border:2px solid var(--cobre);border-radius:12px;padding:18px;}
  h1{color:var(--oro);margin:0;font-size:20px}
  button{border:0;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:800}
  .btn-primary{background:var(--oro);color:#fff}
  .btn-ghost{background:transparent;border:2px solid var(--cobre);color:var(--cobre)}
  .hidden{display:none}
  .opt-btn{padding:12px;border:2px solid var(--cobre);border-radius:8px;background:#fff;cursor:pointer;font-weight:700;}
  .opt-btn:hover{background:var(--cobre);color:#fff}
  .good{color:var(--green);} .bad{color:var(--red);}
  .commission{border:2px solid var(--cobre);padding:8px 12px;border-radius:8px;background:#fffaf0;font-weight:900}
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:2000}
  .modal-card{background:#fff;padding:18px;border-radius:10px;max-width:760px;width:94%}
</style>
</head>
<body>
<div class="wrap">
  <!-- Intro -->
  <section id="intro" class="card">
    <h1>üîë GAMA Post Venta ‚Äî Entrenamiento SPIN‚Ñ¢</h1>
    <p>Simulador de preguntas y decisiones √©ticas para asesores inmobiliarios. Practica situaciones reales, escucha los sonidos de retroalimentaci√≥n y mejora tu desempe√±o.</p>
    <p><b>Objetivo:</b> mantener la comisi√≥n y √©tica durante la post venta.</p>
    <button id="startBtn" class="btn-primary">üéß Iniciar Ejercicio</button>
  </section>

  <!-- Game -->
  <section id="game" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div id="phaseTitle" style="font-weight:900;color:var(--oro);font-size:18px"></div>
        <div id="phaseSub" class="muted"></div>
      </div>
      <div>
        <div>Comisi√≥n:</div>
        <div class="commission" id="commissionDisp">$0</div>
      </div>
    </div>
    <div id="questionText" style="font-weight:800;margin-top:12px;"></div>
    <div id="optionsWrap" style="margin-top:12px;display:grid;gap:8px;"></div>
    <div id="feedbackArea" style="margin-top:10px;font-weight:800;min-height:28px"></div>
    <div style="display:flex;gap:10px;margin-top:12px;">
      <button id="nextBtn" class="btn-primary" disabled>Siguiente ‚û°Ô∏è</button>
      <button id="forceCardBtn" class="btn-ghost">üé¥ Carta Clave</button>
      <div id="progressText" style="margin-left:auto;color:var(--muted);font-size:13px;"></div>
    </div>
  </section>

  <!-- Carta Clave -->
  <div id="cardModal" class="modal hidden">
    <div class="modal-card">
      <h3>üé¥ Carta Clave ‚Äî Acci√≥n √âtica</h3>
      <div id="cardText" style="font-weight:800;margin-bottom:8px;"></div>
      <div id="cardOpts" style="display:grid;gap:8px;"></div>
      <div style="text-align:right;margin-top:12px">
        <button id="closeCard" class="btn-ghost">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Final -->
  <div id="finalModal" class="modal hidden">
    <div class="modal-card">
      <h2 id="finalTitle">üèÅ Resultado</h2>
      <div id="finalSummary"></div>
      <div style="text-align:right;margin-top:12px">
        <button id="restartBtn" class="btn-primary">üîÅ Volver a Entrenar</button>
      </div>
    </div>
  </div>
</div>

<script>
/* CONFIGURACI√ìN */
const TOTAL_COMMISSION = 100000;
const PHASES = [
  {title:'Fase 1 ‚Äî SPIN‚Ñ¢ B√°sico', desc:'Detecta situaci√≥n, problema, implicaci√≥n y necesidad', time:15, count:10},
  {title:'Fase 2 ‚Äî √âtica y objeciones', desc:'Eval√∫a decisiones √©ticas y manejo de objeciones', time:15, count:10}
];

const BANK = [
  {text:'¬øQu√© har√≠as si un cliente reclama por un malentendido de escritura?', options:['Lo escuchas y corriges','Le echas la culpa al notario','Ignoras'], correct:'Lo escuchas y corriges', type:'P'},
  {text:'¬øQu√© pasar√≠a si no revisas las condiciones de apartado con el comprador?', options:['Riesgo de reclamo','Nada','M√°s venta'], correct:'Riesgo de reclamo', type:'I'},
  {text:'¬øQu√© har√≠as si el cliente pide apoyo post venta?', options:['Le das seguimiento','Dices que ya no te toca','Lo bloqueas'], correct:'Le das seguimiento', type:'N'},
  {text:'¬øCu√°l es el prop√≥sito de la llamada de post venta?', options:['Asegurar satisfacci√≥n','Cobrar de nuevo','Venderle otra casa'], correct:'Asegurar satisfacci√≥n', type:'S'},
  {text:'¬øC√≥mo fortaleces la confianza despu√©s de la entrega?', options:['Escuchando y resolviendo','Ignorando','Culpando al banco'], correct:'Escuchando y resolviendo', type:'N'},
  {text:'¬øQu√© har√≠as si el cliente se queja en redes?', options:['Contactarlo y resolver','Ignorarlo','Responder agresivamente'], correct:'Contactarlo y resolver', type:'P'},
  {text:'¬øQu√© pasa si no se documenta la posventa?', options:['Riesgo legal','Nada','Menos trabajo'], correct:'Riesgo legal', type:'I'},
  {text:'¬øQu√© deber√≠as documentar en la entrega?', options:['Acta de entrega','Nada','Mensajes de WhatsApp'], correct:'Acta de entrega', type:'S'},
  {text:'¬øQu√© implica no tener retroalimentaci√≥n del cliente?', options:['Pierdes mejora continua','Nada','Menos presi√≥n'], correct:'Pierdes mejora continua', type:'I'},
  {text:'¬øPor qu√© es importante el seguimiento?', options:['Fideliza al cliente','No lo es','Solo para quejarse'], correct:'Fideliza al cliente', type:'N'}
];

const CARD_POOL = [
  {text:'El cliente firm√≥ apartado y no entendi√≥ penalizaci√≥n. ¬øQu√© haces?', A:'Explicas con empat√≠a', B:'Ignoras', C:'Culpas al banco', correct:'A'},
  {text:'Olvidaste aclarar impuestos al vender. ¬øQu√© haces?', A:'Admites error y corriges', B:'Culpas al notario', C:'Evades tema', correct:'A'}
];

let state = {phaseIndex:0,currentIndex:0,commission:0,perQuestion:0,wrongStreak:0};

/* UI */
const introSec=document.getElementById('intro');
const gameSec=document.getElementById('game');
const startBtn=document.getElementById('startBtn');
const questionText=document.getElementById('questionText');
const optionsWrap=document.getElementById('optionsWrap');
const feedbackArea=document.getElementById('feedbackArea');
const nextBtn=document.getElementById('nextBtn');
const progressText=document.getElementById('progressText');
const commissionDisp=document.getElementById('commissionDisp');
const phaseTitle=document.getElementById('phaseTitle');
const phaseSub=document.getElementById('phaseSub');
const cardModal=document.getElementById('cardModal');
const cardText=document.getElementById('cardText');
const cardOpts=document.getElementById('cardOpts');
const closeCard=document.getElementById('closeCard');
const finalModal=document.getElementById('finalModal');
const finalSummary=document.getElementById('finalSummary');
const restartBtn=document.getElementById('restartBtn');
const forceCardBtn=document.getElementById('forceCardBtn');

/* SONIDOS */
let audioCtx=null;
function ensureAudio(){if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();}
function playTone(f,type='sine',dur=0.1,vol=0.1){try{ensureAudio();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type=type;o.frequency.value=f;o.connect(g);g.connect(audioCtx.destination);g.gain.value=vol;o.start();o.stop(audioCtx.currentTime+dur);}catch(e){}}
function playCorrect(){playTone(880);}
function playWrong(){playTone(200,'square',0.25);}
function playTick(){playTone(1200,'square',0.03);}
function playFanfare(){playTone(900);setTimeout(()=>playTone(1200),150);}

/* FUNCIONES */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function formatMoney(n){return '$'+Math.round(n).toLocaleString('es-MX');}

/* INICIAR */
startBtn.onclick=()=>{ensureAudio();introSec.classList.add('hidden');gameSec.classList.remove('hidden');prepareGame();loadPhase();};

function prepareGame(){
  const totalQ=PHASES.reduce((s,p)=>s+p.count,0);
  state.perQuestion=Math.round(TOTAL_COMMISSION/totalQ);
  state.commission=0;
  commissionDisp.textContent=formatMoney(0);
}

/* RENDER */
function loadPhase(){
  const ph=PHASES[state.phaseIndex];
  phaseTitle.textContent=ph.title;
  phaseSub.textContent=ph.desc;
  state.currentIndex=0;
  renderQuestion();
}

let timer=null,timeLeft=0;
function renderQuestion(){
  clearInterval(timer);
  feedbackArea.textContent='';
  nextBtn.disabled=true;
  const ph=PHASES[state.phaseIndex];
  const q=BANK[state.currentIndex];
  if(!q){finishPhase();return;}
  questionText.textContent=q.text;
  optionsWrap.innerHTML='';
  shuffle(q.options).forEach(opt=>{
    const b=document.createElement('button');
    b.className='opt-btn';b.textContent=opt;
    b.onclick=()=>handleAnswer(opt,q);
    optionsWrap.appendChild(b);
  });
  progressText.textContent=`Pregunta ${state.currentIndex+1}/${BANK.length}`;
  timeLeft=ph.time;
  timer=setInterval(()=>{
    timeLeft--;
    if(timeLeft<=5&&timeLeft>0)playTick();
    if(timeLeft<=0){clearInterval(timer);handleTimeout();}
  },1000);
}

/* RESPUESTAS */
function handleAnswer(choice,q){
  clearInterval(timer);
  document.querySelectorAll('.opt-btn').forEach(b=>b.disabled=true);
  if(choice===q.correct){
    playCorrect();
    state.commission+=state.perQuestion;
    feedbackArea.innerHTML=`<span class="good">‚úÖ Correcto +${formatMoney(state.perQuestion)}</span>`;
  }else{
    playWrong();
    state.commission=Math.max(0,state.commission-state.perQuestion);
    feedbackArea.innerHTML=`<span class="bad">‚ùå Incorrecto -${formatMoney(state.perQuestion)}</span>`;
    state.wrongStreak++;
  }
  commissionDisp.textContent=formatMoney(state.commission);
  nextBtn.disabled=false;
  if(state.wrongStreak>=3){setTimeout(()=>showCard(false),600);}
}

function handleTimeout(){
  playWrong();
  feedbackArea.innerHTML=`<span class="bad">‚è±Ô∏è Tiempo agotado</span>`;
  nextBtn.disabled=false;
  state.wrongStreak++;
  if(state.wrongStreak>=3){setTimeout(()=>showCard(false),600);}
}

nextBtn.onclick=()=>{state.currentIndex++;renderQuestion();};

/* CARTA CLAVE */
forceCardBtn.onclick=()=>showCard(true);
closeCard.onclick=()=>cardModal.classList.add('hidden');

function showCard(forced){
  const card=CARD_POOL[Math.floor(Math.random()*CARD_POOL.length)];
  cardText.textContent=card.text;
  cardOpts.innerHTML='';
  ['A','B','C'].forEach(l=>{
    const b=document.createElement('button');
    b.className='opt-btn';b.textContent=`${l}. ${card[l]||'Opci√≥n omitida'}`;
    b.onclick=()=>resolveCard(l,card);
    cardOpts.appendChild(b);
  });
  cardModal.classList.remove('hidden');
}

function resolveCard(c,card){
  cardModal.classList.add('hidden');
  const gain=Math.round(TOTAL_COMMISSION*0.15),loss=Math.round(TOTAL_COMMISSION*0.10);
  if(c===card.correct){
    playCorrect();
    state.commission+=gain;
  }else{
    playWrong();
    state.commission=Math.max(0,state.commission-loss);
  }
  commissionDisp.textContent=formatMoney(state.commission);
  state.wrongStreak=0;
}

/* FIN DE FASE */
function finishPhase(){
  playFanfare();
  finalModal.classList.remove('hidden');
  finalSummary.innerHTML=`<p>Comisi√≥n final: <b>${formatMoney(state.commission)}</b></p>`;
}

restartBtn.onclick=()=>{
  finalModal.classList.add('hidden');
  introSec.classList.remove('hidden');
  gameSec.classList.add('hidden');
};
</script>
</body>
</html>
